## 一、进程和线程
**进程**  
应用程序的执行实例，每一个进程都是有私有的虚拟地址空间、代码、数据和其他系统资源所组成。

**线程**  
线程是进程内的一个独立执行单元，在不同的线程之间是可以共享进程资源的。

进程拥有独立的堆栈空间和数据段，每当启动一个新的进程必须分配给它独立的地址空间，建立众多的数据表来维护它的代码段、堆栈段和数据段。

线程拥有独立的堆栈空间，但是共享数据段，它们彼此之间使用相同的地址空间，共享大部分数据，比进程更节俭，开销比较小，切换速度也比进程快，效率高。

**总结**  
进程：资源分配的最小单位  
线程：程序执行的最小单位

[进程和线程的区别](https://www.cnblogs.com/Jones-dd/p/8858995.html)

> 在多线程操作下可以实现应用的并行处理，从而以更高的CPU利用率提高整个应用程序的性能和吞吐量。特别是现在很多语言都支持多核并行处理技术，然而JavaScript却以单线程执行，为什么？
> 
> 答：JavaScript作为脚本语言，最初被设计用于浏览器。为了避免复杂的同步问题，如果JavaScript同时有两个线程，一个线程执行在某个DOM节点上添加内容，另一个线程执行删除这个节点，这时就冲突了。
> 
> 所以JavaScript的单线程是这门语言的核心，未来也不会改变。

> HTML5的新特性`Web Worker`可以创建多线程
> 为了解决不可避免的耗时操作（多重循环、复杂的运算），HTML5提供了`Web Worker`，它会在当前的js执行主线程中开辟一个额外的线程来运行js文件，这个新的线程和js主线程之间不会互相影响，同时提供了数据交换的接口：`postMessage`和`onMessage`
> 
> 但是因为它创建的子线程完全受控于主线程，且位于外部文件中，无法访问DOM。所以它并没有改变js单线程的本质。

单线程就意味着，所有的任务都需要排队。

> 语言设计和生活中的现实情况很像，IO设备（输入输出）很慢（比如Ajax），那么语言的设计者意识到这一点，就在主线程中挂起处于等待状态中的任务，先运行后面的任务，等IO设备有了结果，再把挂起的任务执行下去。

## 二、Event Loop
![](https://user-gold-cdn.xitu.io/2019/7/6/16bc675a7df7428e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)
从上图中可以看到，在主线程运行时，会产生堆（heap）和栈（stack）。

堆中存的是声明的object类型的数据，栈中存的是基本数据类型以及函数执行时的运行空间。

栈中的代码回调用各种外部API，它们在任务列表中加入各种事件（onCLick，onLoad，onDone），只要栈中的代码执行完毕（js引擎存在`monitoring process`进程，会持续不断的检查主线程执行栈是否为空），主线程就会去读取任务队列，再按顺序执行这些事件对应的回调函数。

也就是说主线程从任务队列中读取事件，这个过程是循环不断的，所以这种运行机制又称为`Event Loop`（事件循环）。